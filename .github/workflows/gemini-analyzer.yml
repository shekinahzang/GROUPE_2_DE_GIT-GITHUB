
name: Revue de Code Critique (ESLint + Gemini)

on:
  push:
    # ... (branches inchang√©es) ...
  pull_request:
    # ... (branches inchang√©es) ...
  workflow_dispatch:

jobs:
  code_quality_check:
    runs-on: ubuntu-latest
    
    # 1. D√©finition des variables dynamiques (pusher's info)
    env:
      # NOUVEAU: D√©tecte l'e-mail et le nom de l'utilisateur qui a d√©clench√© l'√©v√©nement.
      # Pour 'push' (y compris les commits en ligne)
      PUSHER_EMAIL: ${{ github.event.pusher.email || github.event.pull_request.user.email }}
      PUSHER_NAME: ${{ github.event.pusher.name || github.event.pull_request.user.login }}
      # Simule la pr√©f√©rence utilisateur (doit √™tre configur√©e dans les secrets si complexe, 
      # ou cod√©e en dur si standard pour la CI)
      PREF_INTEREST: "la s√©curit√© et la performance en ligne" 

    steps:
      # ... (checkout, setup-python, installation des d√©pendances inchang√©s) ...
      
      - name: üî¨ Ex√©cution de l'Analyse Statique (ESLint)
        run: |
          ./node_modules/.bin/eslint . --ext .js,.jsx,.ts,.tsx --max-warnings 0
        continue-on-error: false

      - name: üß† Ex√©cution de l'Analyse Critique par Gemini
        run: python gemini_code_analyzer.py
        env:
          # Les variables de la section 'env' du job sont automatiquement inject√©es ici.
          # SECRET (Cl√© API)
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          # SECRETS (SMTP)
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}