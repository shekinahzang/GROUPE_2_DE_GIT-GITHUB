<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="author" content="Ngono" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Livre d'or ‚Äî Laissez un avis Ngono Portfolio</title>
    <style>
        :root{--bg:#f6f8fa;--card:#fff;--muted:#6b7280;--accent:#0ea5a4;--danger:#ef4444}
        *{box-sizing:border-box}
        body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.4;margin:0;background:linear-gradient(180deg,#eef2f7 0,#f8fafc 100%);padding:32px;color:#0f172a}
        .container{max-width:900px;margin:0 auto}
        header{display:flex;align-items:center;gap:16px;margin-bottom:20px}
        header h1{font-size:20px;margin:0}
        .card{background:var(--card);padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(14,22,33,0.06);margin-bottom:16px}
        form .row{display:flex;gap:12px;flex-wrap:wrap}
        label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
        input[type="text"],input[type="email"],textarea,select{
            width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:15px;background:#fff
        }
        textarea{min-height:110px;resize:vertical}
        .grid-2{display:grid;grid-template-columns:1fr 120px;gap:12px}
        .actions{display:flex;gap:8px;align-items:center;margin-top:12px}
        button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
        button.ghost{background:transparent;color:var(--accent);border:1px solid rgba(14,165,164,0.12)}
        button.danger{background:var(--danger)}
        .muted{color:var(--muted);font-size:13px}
        .entries{display:flex;flex-direction:column;gap:12px}
        .entry{padding:12px;border-radius:8px;background:linear-gradient(180deg,rgba(2,6,23,0.02),transparent);display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
        .entry-left{flex:1}
        .meta{display:flex;gap:8px;align-items:center;margin-bottom:8px}
        .name{font-weight:700}
        .time{color:var(--muted);font-size:13px}
        .rating{color:#f59e0b}
        .comment{white-space:pre-wrap}
        .no-entries{color:var(--muted);text-align:center;padding:20px}
        .controls{display:flex;gap:8px;align-items:center}
        .trash{background:transparent;border:0;color:#9ca3af;cursor:pointer;padding:6px;border-radius:6px}
        .small{font-size:13px}
        .charcount{color:var(--muted);font-size:13px;margin-left:auto}
        @media (max-width:600px){.grid-2{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
      <header>
        <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden>
          <path
            d="M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8zM3 20a9 9 0 1 1 18 0H3z"
            fill="#0ea5a4"
          />
        </svg>
        <h1>Livre d'or ‚Äî Laissez un avis</h1>
      </header>

        <section class="card" aria-labelledby="form-title">
            <h2 id="form-title" class="small">Votre avis</h2>
            <form id="guestbookForm" novalidate>
                <div class="row">
                    <div style="flex:1">
                        <label for="name">Nom <span class="muted">*</span></label>
                        <input id="name" name="name" type="text" required placeholder="Votre nom ou pseudo" maxlength="60" />
                    </div>
                    <div style="width:220px">
                        <label for="rating">Note</label>
                        <select id="rating" name="rating" aria-label="Note">
                            <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ 5</option>
                            <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ 4</option>
                            <option value="3">‚òÖ‚òÖ‚òÖ 3</option>
                            <option value="2">‚òÖ‚òÖ 2</option>
                            <option value="1">‚òÖ 1</option>
                        </select>
                    </div>
                </div>

          <div style="margin-top: 12px">
            <label for="email">Email (optionnel)</label>
            <input
              id="email"
              name="email"
              type="email"
              placeholder="exemple@domaine.com"
            />
          </div>

                <div style="margin-top:12px">
                    <label for="comment">Commentaire <span class="muted">*</span></label>
                    <textarea id="comment" name="comment" required maxlength="1000" placeholder="Dites-nous ce que vous pensez..."></textarea>
                    <div style="display:flex;align-items:center;margin-top:6px">
                        <span class="muted small">Merci de rester courtois ‚Äî les propos offensants seront supprim√©s.</span>
                        <span id="charCount" class="charcount">0 / 1000</span>
                    </div>
                </div>

          <div class="actions">
            <button type="submit">Publier</button>
            <button type="button" class="ghost" id="previewBtn">Aper√ßu</button>
            <div style="margin-left: auto" class="muted small">
              Les avis sont stock√©s localement dans votre navigateur.
            </div>
          </div>
        </form>
      </section>

        <section class="card" aria-labelledby="list-title">
            <h2 id="list-title" class="small">Avis des visiteurs</h2>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                <div class="muted small">Derniers avis en haut</div>
                <div>
                    <button class="ghost" id="clearAllBtn">Supprimer tout</button>
                </div>
            </div>
            <div id="entries" class="entries" aria-live="polite"></div>
        </section>
    </div>

    <script>
      // Simple client-side guestbook using localStorage. Input is escaped when rendered to avoid XSS.
      const STORAGE_KEY = "guestbook.entries.v1";
      const form = document.getElementById("guestbookForm");
      const entriesEl = document.getElementById("entries");
      const charCount = document.getElementById("charCount");
      const commentEl = document.getElementById("comment");
      const previewBtn = document.getElementById("previewBtn");
      const clearAllBtn = document.getElementById("clearAllBtn");

      function loadEntries() {
        try {
          return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
        } catch (e) {
          console.error("√âchec lecture storage", e);
          return [];
        }
      }

      function saveEntries(list) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
        renderEntries();
      }

      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function timeAgo(dateISO) {
        const d = new Date(dateISO);
        const diff = Math.floor((Date.now() - d) / 1000);
        if (diff < 60) return diff + "s";
        if (diff < 3600) return Math.floor(diff / 60) + "m";
        if (diff < 86400) return Math.floor(diff / 3600) + "h";
        return d.toLocaleString();
      }

      function renderEntries() {
        const entries = loadEntries().slice().reverse(); // latest first
        entriesEl.innerHTML = "";
        if (entries.length === 0) {
          entriesEl.innerHTML =
            '<div class="no-entries">Aucun avis pour l\'instant. Soyez le premier √† laisser un commentaire !</div>';
          return;
        }
        for (const e of entries) {
          const div = document.createElement("div");
          div.className = "entry";
          div.innerHTML = `
                    <div class="entry-left">
                        <div class="meta">
                            <div class="name">${escapeHtml(e.name)}</div>
                            <div class="time">¬∑ ${timeAgo(e.date)}</div>
                            <div style="margin-left:8px" class="rating">${"‚òÖ".repeat(
                              e.rating
                            )}${"‚òÜ".repeat(5 - e.rating)}</div>
                            ${
                              e.email
                                ? '<div style="margin-left:8px;color:var(--muted);font-size:13px">¬∑ ' +
                                  escapeHtml(e.email) +
                                  "</div>"
                                : ""
                            }
                        </div>
                        <div class="comment">${escapeHtml(e.comment)}</div>
                    </div>
                    <div class="controls">
                        <button class="trash" data-id="${
                          e.id
                        }" title="Supprimer">üóëÔ∏è</button>
                    </div>
                `;
          entriesEl.appendChild(div);
        }
        // attach delete handlers
        entriesEl.querySelectorAll(".trash").forEach((btn) => {
          btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-id");
            if (!confirm("Supprimer cet avis ?")) return;
            const list = loadEntries().filter((x) => x.id !== id);
            saveEntries(list);
          });
        });
      }

      form.addEventListener("submit", (ev) => {
        ev.preventDefault();
        const formData = new FormData(form);
        const name = (formData.get("name") || "").trim();
        const email = (formData.get("email") || "").trim();
        const rating = parseInt(formData.get("rating") || "5", 10);
        const comment = (formData.get("comment") || "").trim();

        if (!name) {
          alert("Veuillez indiquer votre nom.");
          return;
        }
        if (!comment) {
          alert("Veuillez √©crire un commentaire.");
          return;
        }

        const entry = {
          id: Date.now().toString(36) + Math.random().toString(36).slice(2, 8),
          name,
          email,
          rating,
          comment,
          date: new Date().toISOString(),
        };

        const list = loadEntries();
        list.push(entry);
        saveEntries(list);
        form.reset();
        charCount.textContent = "0 / 1000";
        document.getElementById("name").focus();
      });

      commentEl.addEventListener("input", () => {
        charCount.textContent = `${commentEl.value.length} / ${
          commentEl.maxLength || 1000
        }`;
      });

      previewBtn.addEventListener("click", () => {
        const name = document.getElementById("name").value.trim() || "Vous";
        const rating = parseInt(
          document.getElementById("rating").value || "5",
          10
        );
        const comment = document.getElementById("comment").value.trim() || "";
        const previewDiv = document.createElement("div");
        previewDiv.className = "card";
        previewDiv.style.marginTop = "12px";
        previewDiv.innerHTML = `
                <div class="meta"><strong>${escapeHtml(
                  name
                )}</strong> ¬∑ <span class="rating">${"‚òÖ".repeat(
          rating
        )}${"‚òÜ".repeat(5 - rating)}</span></div>
                <div style="margin-top:8px">${escapeHtml(comment)}</div>
            `;
        // small modal-like behavior
        const overlay = document.createElement("div");
        overlay.style.position = "fixed";
        overlay.style.left = "0";
        overlay.style.top = "0";
        overlay.style.right = "0";
        overlay.style.bottom = "0";
        overlay.style.background = "rgba(2,6,23,0.45)";
        overlay.style.display = "flex";
        overlay.style.alignItems = "center";
        overlay.style.justifyContent = "center";
        overlay.addEventListener("click", () =>
          document.body.removeChild(overlay)
        );
        previewDiv.style.maxWidth = "640px";
        previewDiv.style.width = "90%";
        overlay.appendChild(previewDiv);
        document.body.appendChild(overlay);
      });

      clearAllBtn.addEventListener("click", () => {
        if (!confirm("Supprimer tous les avis enregistr√©s localement ?"))
          return;
        localStorage.removeItem(STORAGE_KEY);
        renderEntries();
      });

      // initial render
      renderEntries();
    </script>
  </body>
    <footer>
  <p>¬© 2025 Groupe 2 - Contributeur : Abiga√´l Komdjam</p>
</footer>

</body>
</html>
